<div class="dashboard-container">
  <h2 class="jh-card-title">Dashboard Analítico</h2>

  <jhi-alert-error></jhi-alert-error>

  <!-- Loading Overlay -->
  <div class="loading-overlay" *ngIf="isLoading">
    <div class="loading-content">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Carregando...</span>
      </div>
      <p class="loading-text mt-3">Carregando dados do dashboard...</p>
    </div>
  </div>

  <div class="row" [ngClass]="{ 'content-loading': isLoading }">
    <!-- KPIs -->
    <div class="col-md-12 mb-4">
      <div class="row">
        <div class="col-md-6">
          <div class="card kpi-card">
            <div class="card-body">
              <h5 class="card-title">Total de Ordens de Serviço</h5>
              <h2 class="card-text">
                <fa-icon icon="tools" class="me-2"></fa-icon>
                {{ dashboard?.totalServiceOrders ?? 0 }}
              </h2>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card kpi-card revenue-kpi">
            <div class="card-body">
              <h5 class="card-title">Faturamento Total</h5>
              <h2 class="card-text">
                <fa-icon icon="dollar-sign" class="me-2"></fa-icon>
                R$ {{ dashboard?.totalRevenue ?? 0 | number: '1.2-2' }}
              </h2>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Gráfico de Ordens de Serviço por Status -->
    <div class="col-md-6 mb-4">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">
            <fa-icon icon="chart-pie" class="me-2"></fa-icon>
            Ordens de Serviço por Status
          </h5>
          <div class="chart-container">
            <canvas baseChart [data]="serviceOrdersByStatusData" [options]="pieChartOptions" [type]="pieChartType"> </canvas>
          </div>
          <div class="status-legend mt-3 text-center">
            <span class="badge bg-success me-2">Em Andamento</span>
            <span class="badge bg-danger me-2">Criada</span>
            <span class="badge bg-warning me-2">Concluída</span>
            <span class="badge bg-secondary">Cancelada</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Gráfico de Tipos de Serviço Mais Realizados -->
    <div class="col-md-6 mb-4">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">
            <fa-icon icon="wrench" class="me-2"></fa-icon>
            Tipos de Serviço Mais Realizados
          </h5>
          <div class="chart-container">
            <canvas baseChart [data]="topServiceTypesData" [options]="barChartOptions" [type]="barChartType"> </canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Gráfico de Faturamento por Mês -->
    <div class="col-md-12 mb-4">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">
            <fa-icon icon="chart-line" class="me-2"></fa-icon>
            Faturamento por Mês
          </h5>
          <div class="chart-container">
            <canvas baseChart [data]="revenueByMonthData" [options]="lineChartOptions" [type]="lineChartType"> </canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Gráfico de Clientes Mais Frequentes -->
    <div class="col-md-12 mb-4">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">
            <fa-icon icon="users" class="me-2"></fa-icon>
            Clientes Mais Frequentes
          </h5>
          <div class="chart-container">
            <canvas baseChart [data]="topClientsData" [options]="horizontalBarChartOptions" [type]="horizontalBarChartType"> </canvas>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
